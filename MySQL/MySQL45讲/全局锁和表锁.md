## MySQL的锁

锁的作用是用来处理并发问题，当出现并发问题的时候数据库需要合理的控制资源访问，这个时候锁就是用来实现访问规则的重要手段。

### MySQL的锁分类

根据加锁的范围，MySQL中的锁可以分为三种:

+ 全局锁
+ 表级锁
+ 行锁

### 全局锁

MySQL提供了一种全局读锁的方法，命令是Flush tables with read lock (FTWRL)，当需要让整个数据库处于只读状态，可以使用这个命令，之后其他所有线程执行以下命令都会被阻塞。

+ 数据更新语句(数据的增删改)
+ 数据定义语句(建表，修改表结构等)
+ 更新类事务

全局锁的应用主要是全库逻辑备份，也就是把整个库中的所有表都select出来存为文本。

### 表级锁

MySQL中的表级锁有两种：一种是表锁，一种是元数据锁(MDL)，MDL锁是系统默认的锁。

### 行锁

行锁是针对数据表中记录的锁，MySQL行锁是在引擎层由各个引擎自己实现的，但并不是所有的引擎都支持行锁，比如MylSAM引擎就不支持行锁。不支持行锁意味着并发控制只能使用表锁。

### 两段锁协议

在InnoDB中，行锁是在需要的时候才加上的，但并不是不需要了就立马释放，而是在等到事务结束的时候才释放。

### 死锁与死锁检测

### MySQL解决死锁的方法

+ 控制并发度，在客户端做并发控制
+ 临时关闭死锁检测

