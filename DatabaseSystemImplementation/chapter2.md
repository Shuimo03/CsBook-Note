## 辅助存储管理
### 存储器层次(速度从高到低)
1. 高速缓存
2. 主存储器
3. 辅助存储器
4. 第三级存储器
### 存储器分类
+ 非易失的
  + 第三方存储器
  + 虚拟存储器
  + 磁盘
  + 文件系统
+ 易失的
  + 高速缓存
  + 主存储器
### 在存储器层次间传送数据
正常情况下，数据在相邻层之间传输，但是访问想要的数据或者查找指定的位置以及存储数据会消费大量时间，
所以当需要数据的时候，每一层的访问都会被组织起来，以便于下层传输大量数据。

数据库系统特别重要的是磁盘被划分为磁盘块，像操作系统的页一样，每块大小是4-64KB，整个块被安排在缓冲区中，缓冲区
是一个连续的内存区域，在这个区域移出移进。

主存储器与高速缓存之间的传输是以高数缓存线为基本单元，一般是32个连续字节。
## 虚拟存储器
虚拟存储器是一个地址空间，大小一般为32位，即在虚拟存储器中2^32B或者4GB，操作系统
管理虚拟存储器，让它的一部分留在内存中，剩下部分都保存在磁盘中，磁盘和内存的数据都是以磁盘块为单位。
## 磁盘结构
辅助存储器是数据库管理系统的重要特性之一，而辅助存储器几乎都是基于磁盘的，一个从磁盘驱动器主要是两个主要的移动部件
+ 磁盘组合
+ 磁头组合

磁盘组和由一个或多个圆盘组成，围绕着一根中心主轴旋转，圆盘表面覆盖了一层磁性材料，二进制就被存储在这些磁性材料上。
磁盘被组织成磁道，磁道是单个盘片上的同心圆，所有盘面上半径相同的磁道构成了柱面。

磁道被组织成扇区，扇区是被间隙分割的圆的片段，间隙未被磁化为0或1。
扇区是不可分割的单位。
### 磁盘控制器
一个或者多个磁盘驱动器被一个磁盘控制器所控制，磁盘控制器是一个小处理器，能够完成以下功能:
+ 控制移动磁头组合的机械马达，将磁头定位到一个特定的半径位置，让某一柱面任何磁道都可以被读写到。
+ 从磁头所在柱面的扇区中选择一个扇区。
+ 将从所要求的扇区读取的二进制位传送到计算机的主存储器。
+ 可能的话，将一整条或更多磁道缓存于磁盘控制器的内存中，期待该磁道的许多扇区能够被很快读取。
### 磁盘存取特性
存储一个磁盘一共需要三步：
+ 寻道时间: 磁盘控制器将磁头组合定位在磁盘块所在磁道的柱面上所需要的时间。
+ 旋转延迟: 磁盘控制器等待访问块的第一个扇区旋转到磁头下。
+ 传输时间: 当磁盘控制器读取或写数据的时候，数据所在的扇区和扇区间的空隙经过磁头。

三者时间加起来被称为磁盘的延迟，一个典型磁盘的寻道时间取决于磁头到它要访问位置的距离。
## 加速对辅助存储管理器的访问
加速典型数据库访问磁盘的技术:
1. 将要一起访问的块放在同一个柱面上,这样可以避免寻道时间,也可能避免旋转延迟。
2. 将数据分隔存储在几个相对较小的磁盘上而不是存放在一个大磁盘上，让更多的磁头设备分别去访问磁盘块可增加在单位时间内的磁盘块访问数量。
3. "镜像"磁盘，把两个或者更多的数据副本放在不同的磁盘上，这个策略除了可以保存数据以备某个磁盘可能坏掉，如同将数据分隔存储几个磁盘上，可以一次性访问更多的磁盘块。
4. 在操作系统、DBMS或磁盘控制器中，使用调用算法旋转读写算请求的块的顺序。
5. 预先将预期被访问的磁盘块取到主存储器中。
## 磁盘镜像
在某些情况下，有两个或更多的磁盘保留一样的数据副本是有意义的，这些磁盘被称为相互镜像，一个重要的原因是，凭借另一个磁盘使用数据不会因为一个磁头的损坏而损坏，
因为已损磁盘的镜像上的数据仍然可读。具有增强可靠性的系统经常使用磁盘对互为镜像。
## 磁盘故障
+ 间断性故障: 读或写一个扇区的某次尝试没有成功,但是经过反复尝试，又能成功读或写。
+ 介质损坏: 在这种故障中一个或者多个二进制位永久的损坏，不管尝试多少次，都不可能正确的读取一个扇区。
+ 写故障: 当企图写一个扇区的时候，既不能正确的写，也不能检索先前写入的扇区，一种可能的原因是因为写扇区的过程中发生了供电中断。
+ 磁盘崩溃: 整个磁盘突然变得永久不可读。

检查间断性故障的一种方法是奇偶校验。
## 稳定存储
## 组织磁盘上的数据
用一个记录来表示一个数据元素在磁盘中的连续字节存放，通常来说，通过将表示数据元素的记录放在一个或者多个磁盘块中来表示诸如关系的数据集，
一个磁盘块中仅存放一个关系的元素是一种常见的组织方式。
### 定长记录
最简单类型的记录由定长字段组成，元组的每个属性都对应一个字段，当数据的开始地址是4或8的时，很多机器都允许甚至要求更有效率的内存读写。
所以，通常会根据情况使所有字段的起始地址是4或8的倍数。

虽然记录被存放在辅助存储器中，但是记录的操作还是在内存中进行。
通常，记录都以记录的首部开始，比如，一个元组的记录可以指向该元组所属的关系的模式，这个信息可以找到记录的字段:
1. 一个只想该记录中存储数据的模式的指针。
2. 记录长度。
3. 时间戳
4. 指向记录的字段的指针

## BLOB
## 记录的修改
+ 插入
+ 删除
+ 修改