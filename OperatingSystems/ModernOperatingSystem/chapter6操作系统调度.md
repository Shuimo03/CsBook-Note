## 调度

### 调度指标

和性能相关的指标：

+ 吞吐量
+ 周转时间
+ 响应时间

非性能指标：

+ 公平性
+ 资源利用率

### 调度需要考虑的事情

+ 调度开销与调度效果
+ 优先级与公平性
+ 性能与能耗

### 长期调度

**长期调度就像是一个阀门，用来限制系统中真正被短期调度管理的进程数量**，避免短期调度的开销过大。当长期调度为某个程序创建了进程并把其状态设置为预备状态之后，会通过短期调度进一步管理该进程。

另外，根据进程主要使用的资源类型可以分为两种：

+ 计算密集型
+ IO密集型

### 短期调度

实际上做出调度决策的是短期调度，短期调度主要负责进程在预备状态，运行状态，阻塞状态之间转换。

### 中期调度

### 任务调度

## 单核调度策略

每个任务都有自己到达的时间和运行的时间，到达时间用来表示该任务何时被发起并处于预备状态，运行时间用来表示该任务从开始执行到结束一共花费了多少时间，在不考虑调度开销的情况下，所有调度都是即时完成的。

虽然多个任务并发的在一个共享的CPU核心上执行，但是它的本质仍然是串行。

### 经典调度

+ FIFO 先到先得调度
+ 最短时间优先
  + SJF
  + STCF
+ 时间片轮转

#### FIFO先来先到调度

特点是和队列一样，按照顺序调度，优点是容易实现，缺点是如果是长短任务混合使用的时候，对短任务是不友好的。

#### 最短时间优先

#### 时间片轮转

### 优先级调度

+ 多级队列(MLQ)
+ 多级反馈队列

### 公平共享调度

+ 彩票调度
  + 彩票转让
  + 彩票货币
  + 彩票膨胀
+ 步幅调度

### 实时调度

实时任务可以分为两类：

+ 硬实时任务：该任务必须在截止时间之前完成。
+ 软实时任务：该任务可以偶尔超过截止完成时间。

实时任务也可以根据触发时间分为三类：

+ 周期任务
+ 偶发任务
+ 非周期任务

## 多核调度

在多核系统中，任务会同时的在多个CPU核心上并行的执行。

### 负载分担

假设多核共享一个全局运行队列，当一个CPU核心需要调度任务的时候，根据给定它的调度策略，决定全局运行队列中下一个由它执行的任务。

负载分担的好处如下：

+ 通过使用负载分担可以把多核调度问题规约成单核调度问题，使用已有的单核调度策略和单核调度器就可以实现一个多核的全局调度器。
+ 每个CPU核心都会分担系统的负载，不会出现CPU资源浪费的情况。
+ 一个CPU核心执行完当前任务后，它会从全局任务队列中在选取一个任务执行。

### 协同调度

### 并行计算

### BSP计算模型

+ 并法计算：每个CPU核心独立计算自己的子任务。
+ 通信：CPU核心之间通过通信交换数据。
+ 同步：一个CPU核心在执行到程序设置的某个屏障点时，需要等待其他CPU核心也到达这个屏障点，才能执行后续代码逻辑。

### 群组调度

将关联的任务设置为一组，并以组为单位调度在多个CPU核心上执行，使它们开始时间和结束时间接近相同。

### 两级调度

### 负载追踪



### 负载均衡

通过追踪每个CPU核心当前的负载情况，将处于高负载的CPU核心管理任务迁移到低负载的CPU核心上，尽可能的保证每个核心的负载大致相同。

### NUMA架构

## 现代调度器

### Linux调度器

+ O(n)调度器
+ O(1)调度器
+ CFS完全公平调度器

## 问题

+ 为什么需要计算机调度？
+ 计算机是如何进行调度的？
+ 计算机调度应该达到什么样的效果？
+ 设计实现计算机调度有何困难？
+ 在多核处理器上，CPU需要考虑的三个问题：
  + 当前应该调度那个/那些任务？
  + 每个调度的任务应该在那个CPU核心上执行？
  + 每个调度的任务应该执行多久？

