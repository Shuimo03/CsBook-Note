# chapter1 UNIX基础知识

## UNIX体系结构

操作系统也算是一种软件，它控制计算机硬件资源，提供程序的运行环境，所以操作系统又被称为内核，因为相对来说较小，而且位于环境中心。

1. 内核
2. 系统调用
3. 公用函数库
4. 应用程序

应用程序既可以调用公用函数库也可以使用系统调用。

## 登录

### 查看用户名

用户在登陆UNIX系统的时候，先输入登录名，如何输入密码，可以在/etc/passwd中查看登录名。

```
登录名:加密口令:数字用户ID:数字组ID:注释字段:起始目录:shell程序
```

### shell

shell是一个命令解释器，用于读取用户输入，然后执行指令，UNIX默认shell如下

- Bourne shell
- Bourne-again shell
- C shell
- Korn shell
- TENEX shell

## 文件和目录

### 文件系统

UNIX文件系统时目录和文件的一种层次结构，所有东西的起点时称为根的目录，这个目录的名称是一个字符"/"

### 文件属性

1. 文件类型
   1. 普通文件
   2. 目录等等
2. 文件大小
3. 文件所有者
4. 文件权限
5. 文件最后修改的时间

### 文件名

UNIX中的文件名，不能出现空字符和斜线，因为斜线是用来分隔成路径名的各文件名，空字符是用来终止一个路径名。

文件名应该限制在下面这些字符集之内

1. 大小写字母
2. 数字
3. 句点
4. 短横线
5. 下划线

### 路径名

1. 绝对路径
2. 相对路径

### 工作目录和起始目录

1. 工作目录：每个进程都有一个工作目录，有时候称为当前工作目录，所有相对路径名都从工作目录开始解释。
2. 起始目录：登录的时候，工作目录设置为其实目录，该起始目录从口令文件中相应用户的登录项中取得。

## 输入输出

### 文件描述符

文件描述符通常是一个小的非负整数，内核用来表示一个特定进程正在访问的文件，当内核打开一个现有文件或者创建一个新文件的时候，都返回一个文件描述符，之后如果要对文件操作的时候，都可以使用这个文件描述符。

### 标准输入/标准输出/标准错误

每当运行一个新的程序时，所有的shell都会为新的程序打开3个文件描述符：

1. 标准输入
2. 标准输出
3. 标准错误

### 不带缓冲的I/O

这些函数不提供带缓冲的I/O，因为这些函数都是使用文件描述符

1. open
2. read
3. write
4. lseek
5. close

### 标准IO

标准的IO函数为那些不带缓冲的IO函数提供了一个带缓冲的接口，使用标准的IO函数不需要担心如何选择最佳的缓冲区大小。

## 程序和进程

程序一个存储在磁盘上某个目录的可执行文件，内核使用exec函数把程序读入内存中，并且执行程序。

进程是程序的执行实例，UNIX系统确保每一个进程都有唯一的数字标识符，称为进程ID，进程ID总是一个非负整数。

### 进程控制函数

1. fork
2. exec
3. waitpid

### 线程和线程ID

通常来说，一个进程只有一个控制线程，某个时刻执行的一组机器指令，对于某些问题来说，如果有多个控制线程分别作用于它的不同部分，那解决起来就轻松很多，另外，多个控制线程也可以充分利用多处理器系统的并行能力。

一个进程内的线程之所以能够共享资源(地址空间/文件描述符/栈/以及和进程相关的属性)，是因为它们都可以访问同一个存储区，所以各线程在访问共享数据的时候需要使用同步技巧来避免不一致性。

和进程一样，线程也有ID，但是线程ID只在它所属的进程内起作用，一个进程中的线程ID在另一个进程中没有任何意义。

## 出错处理

当UNIX系统出错的时候，通常会返回一个负值，而且整型变量errno通常被设置为具有特定信息的值，对于errno有两条规则：

1. 如果没有出错，其值不会被例程清除，因为当且仅当函数的返回值指明出错的时候，才会检验其值。
2. 任何函数都不会将errno值设置为0，而且在<errno.h>中定义的所有常量都不会为0。

<errno.h>中的错误分为两类

1. 致命性错误
2. 非致命性错误

## 用户标识

### 用户ID

口令文件登录项中的用户ID是一个数值，它向系统标识各个不同的用户，系统管理员在确定一个用户的登录名的同时，确定其用户ID，用户不能更改其用户ID，通常每个用户有一个唯一用户ID。

ID为0的用户称为根用户或者超级用户。

### 组ID

口令文件登录项也包括用户的组ID，它是一个数值，组ID也是由系统管理员在指定用户登录名的时候分配的，一般来说，在口令文件中有多个登录项具有相同的组ID。

## 信号

## 时间值

## 系统调用和库函数

